<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Suporte X ‚Äî Painel de Atendimentos</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="icon" href="/favicon.ico" sizes="any" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="stylesheet" href="/central.css" />
  </head>
  <body data-tech-name="Isac Xavier">
    <div class="app-shell">
      <aside class="sidebar">
        <div class="brand">
          <img src="/icon-192.png" alt="Logo Suporte X" />
          <div>
            <h1>Painel de Atendimentos</h1>
            <span>Opera√ß√µes em tempo real</span>
          </div>
        </div>
        <div class="availability-control">
          <div class="row" id="availabilityRow">
            <label class="muted small" style="flex: 1;">Painel de Atendimentos</label>
            <label class="switch">
              <input id="autoSwitch" type="checkbox" />
              <span class="slider"></span>
            </label>
          </div>
          <div class="small muted" id="autoSwitchLabel">ACEITAR CHAMADOS AUTOMATICAMENTE</div>
        </div>
        <div>
          <div class="section-title">Fila de chamados</div>
          <div class="queue-list" id="queue" aria-live="polite"></div>
          <div class="empty-state muted small" id="queueEmpty" hidden>Nenhum chamado aguardando atendimento.</div>
          <button class="queue-retry-btn" id="queueRetry" type="button" hidden>Recarregar</button>
        </div>
        <div>
          <div class="section-title">Filtros r√°pidos</div>
          <div class="ticket-actions">
            <button class="tag-btn">Padr√£o</button>
            <button class="tag-btn">SLA cr√≠tico</button>
            <button class="tag-btn">Chamadas</button>
          </div>
        </div>
      </aside>
      <div class="content">
        <header class="topbar">
          <div class="topbar-left">
            <div class="status-pill">
              <span class="status-indicator" aria-hidden="true"></span>
              <span id="availabilityLabel">Dispon√≠vel</span> ‚Ä¢ <span id="techRole">T√©cnica n√≠vel 2</span>
            </div>
            <div>
              <div class="section-title" style="margin: 0;">Sess√µes ativas</div>
              <strong id="activeSessionsLabel">0 em andamento</strong>
            </div>
          </div>
          <div class="topbar-actions">
            <button class="theme-switch" id="themeSwitch" type="button">Tema claro</button>
            <button class="icon-btn" type="button" aria-label="Notifica√ß√µes">
              üîî
            </button>
            <div class="profile-chip">
              <div class="profile-avatar">IX</div>
              <div>
                <strong id="topbarTechName">Isac Xavier</strong>
                <div class="section-title" style="margin: 0; font-size: 11px;" id="techRoleSecondary">Supervisor</div>
              </div>
            </div>
          </div>
        </header>
        <main class="dashboard">
          <section class="cards-grid">
            <article class="metric-card" id="metricAttendances">
              <span class="metric-label">Atendimentos hoje</span>
              <span class="metric-value" data-metric="attendances">0</span>
              <span class="metric-trend" data-metric="queue">Fila atual: 0</span>
            </article>
            <article class="metric-card" id="metricFcr">
              <span class="metric-label">FCR (Primeiro contato)</span>
              <span class="metric-value" data-metric="fcr">‚Äî</span>
              <span class="metric-trend" data-metric="fcr-detail">Aguardando dados</span>
            </article>
            <article class="metric-card" id="metricNps">
              <span class="metric-label">NPS</span>
              <span class="metric-value" data-metric="nps">‚Äî</span>
              <span class="metric-trend" data-metric="nps-detail">Coletado ao encerrar</span>
            </article>
            <article class="metric-card" id="metricHandleTime">
              <span class="metric-label">Tempo m√©dio</span>
              <span class="metric-value" data-metric="handle">‚Äî</span>
              <span class="metric-trend" data-metric="wait">Espera m√©dia ‚Äî</span>
            </article>
          </section>

          <section class="session-area triple-panels">
            <aside class="panel equal-panel device-panel">
              <div class="panel-header">
                <h2>Contexto do dispositivo</h2>
              </div>
              <div class="panel-body">
                <div class="device-info">
                  <div class="context-grid">
                    <div class="context-item">
                      <strong>Aparelho</strong>
                      <span id="contextDevice">‚Äî</span>
                    </div>
                    <div class="context-item">
                      <strong>Identifica√ß√£o</strong>
                      <span id="contextIdentity">‚Äî</span>
                    </div>
                    <div class="context-item">
                      <strong>Rede atual</strong>
                      <span id="contextNetwork">Aguardando dados do app</span>
                    </div>
                    <div class="context-item">
                      <strong>Sa√∫de do dispositivo</strong>
                      <span id="contextHealth">‚Äî</span>
                    </div>
                    <div class="context-item">
                      <strong>Permiss√µes cr√≠ticas</strong>
                      <span id="contextPermissions">‚Äî</span>
                    </div>
                  </div>
                  <div class="device-extras">
                    <div class="context-item">
                      <strong>Armazenamento livre</strong>
                      <span>12GB de 128GB</span>
                    </div>
                    <div class="context-item">
                      <strong>N√≠vel de bateria</strong>
                      <span>42% (Carregando)</span>
                    </div>
                    <div class="context-item">
                      <strong>Temperatura do dispositivo</strong>
                      <span>36¬∞C</span>
                    </div>
                    <figure class="device-image">
                      <img src="/meramente-ilustrativo.webp" alt="Imagem do dispositivo" />
                      <figcaption>Imagem do dispositivo</figcaption>
                    </figure>
                  </div>
                </div>
                <div class="device-timeline">
                  <div class="section-title">Timeline</div>
                  <div class="timeline" id="contextTimeline">
                    <div class="timeline-entry">Sem eventos registrados ainda.</div>
                  </div>
                </div>
              </div>
            </aside>

            <section class="panel equal-panel session-panel">
              <div class="panel-header">
                <h2>Sess√£o em andamento</h2>
              </div>
              <div class="panel-body">
                <div class="session-main">
                  <div class="web-share" id="webSharePanel">
                    <div class="web-share-header">
                      <strong>Compartilhamento web (Send)</strong>
                      <span class="muted small">Informe o c√≥digo gerado no navegador do cliente.</span>
                    </div>
                    <div class="web-share-controls">
                      <input id="webShareRoom" type="text" inputmode="numeric" placeholder="C√≥digo de 6 d√≠gitos" maxlength="6" />
                      <button type="button" id="webShareConnect">Conectar</button>
                      <button type="button" id="webShareDisconnect" disabled>Desconectar</button>
                    </div>
                    <div class="web-share-status muted small" id="webShareStatus">Nenhum compartilhamento web ativo.</div>
                  </div>
                  <div class="video-shell" id="videoShell">
                    <video id="sessionVideo" autoplay playsinline muted hidden></video>
                    <canvas id="whiteboardCanvas" class="whiteboard-canvas" hidden></canvas>
                    <textarea
                      id="remoteTextInput"
                      class="remote-text-input"
                      autocomplete="off"
                      autocapitalize="off"
                      autocorrect="off"
                      spellcheck="false"
                      aria-hidden="true"
                    ></textarea>
                    <audio id="sessionAudio" autoplay hidden></audio>
                    <div class="placeholder" id="sessionPlaceholder">Aguardando sele√ß√£o de sess√£o</div>
                    <div class="control-menu-backdrop" id="controlMenuBackdrop" hidden></div>
                    <div class="control-menu">
                      <div class="control-menu-panel" id="controlMenuPanel" role="menu" aria-hidden="true">
                        <button type="button" id="controlStart" role="menuitem">Solicitar visualiza√ß√£o</button>
                        <button type="button" id="controlQuality" role="menuitem">Iniciar chamada</button>
                        <button type="button" id="controlRemote" role="menuitem">Solicitar acesso remoto</button>
                        <button type="button" id="controlFullscreen" role="menuitem">Tela cheia</button>
                        <button type="button" id="controlPip" role="menuitem">Janela flutuante</button>
                        <button type="button" id="controlStats" role="menuitem">Encerrar suporte</button>
                      </div>
                      <button
                        type="button"
                        id="controlMenuToggle"
                        class="control-menu-toggle"
                        aria-expanded="false"
                        aria-controls="controlMenuPanel"
                        aria-label="Abrir menu de a√ß√µes"
                      >
                        <span class="control-menu-dots" aria-hidden="true"></span>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="indicators session-metrics">
                  <div class="indicator">
                    <strong>Rede do cliente</strong>
                    <span id="indicatorNetwork">‚Äî</span>
                  </div>
                  <div class="indicator">
                    <strong>Qualidade da sess√£o</strong>
                    <span id="indicatorQuality">‚Äî</span>
                  </div>
                  <div class="indicator">
                    <strong>Alertas</strong>
                    <span id="indicatorAlerts">‚Äî</span>
                  </div>
                </div>
              </div>
            </section>

            <aside class="panel chat-panel equal-panel">
              <div class="panel-header">
                <h2>Comunica√ß√£o</h2>
              </div>
              <div class="panel-body chat-area">
                <div class="chat-thread" aria-live="polite" id="chatThread">
                </div>
                <div class="chat-footer">
                  <div class="quick-replies">
                    <button type="button" data-reply="Ol√°, sou do Suporte X. Vou assumir o seu atendimento agora.">Enviar mensagem inicial</button>
                    <button type="button" data-reply="Para continuar, preciso que libere o compartilhamento de tela nas configura√ß√µes.">Solicitar permiss√£o de acessibilidade</button>
                    <button type="button" data-reply="Vou encerrar o atendimento por aqui. Qualquer novidade √© s√≥ chamar!">Avisar sobre encerramento</button>
                  </div>
                  <form class="chat-form" id="chatForm">
                    <input type="text" placeholder="Digite uma mensagem ou use /comandos" aria-label="Mensagem" id="chatInput" />
                    <button type="submit">Enviar</button>
                  </form>
                </div>
              </div>
            </aside>
          </section>

          <section class="panel">
            <div class="panel-header">
              <h2>Encerramento</h2>
            </div>
            <form class="panel-body closure" id="closureForm">
              <label>
                Resultado
                <select id="closureOutcome" required>
                  <option value="resolved">Resolvido</option>
                  <option value="partial">Parcial</option>
                  <option value="transferred">Transferido</option>
                  <option value="cancelled">Cancelado</option>
                </select>
              </label>
              <label>
                Sintoma principal
                <textarea rows="2" placeholder="Ex.: C√¢mera fecha ao abrir a leitura de QR Code" id="closureSymptom"></textarea>
              </label>
              <label>
                Solu√ß√£o aplicada
                <textarea rows="3" placeholder="Ex.: Limpeza de cache + atualiza√ß√£o do app pelo Play Store" id="closureSolution"></textarea>
              </label>
              <div class="closure-grid">
                <label>
                  NPS (0-10)
                  <input type="number" min="0" max="10" step="1" id="closureNps" />
                </label>
                <label class="checkbox">
                  <input type="checkbox" id="closureFcr" />
                  <span>Resolvido no primeiro contato</span>
                </label>
              </div>
              <button class="primary-action" type="submit" id="closureSubmit">Encerrar suporte e disparar pesquisa</button>
            </form>
          </section>
        </main>
      </div>
    </div>
    <div class="call-modal" id="callModal" hidden>
      <div class="call-modal-card" role="dialog" aria-live="polite" aria-label="Chamada de voz">
        <div class="call-modal-header">
          <strong class="call-modal-title">Chamada de voz</strong>
          <span class="call-modal-status" id="callModalStatus">Chamando‚Ä¶</span>
        </div>
        <div class="call-modal-body">
          <div class="call-modal-avatar" aria-hidden="true">‚òéÔ∏è</div>
          <div class="call-modal-info">
            <div class="call-modal-name" id="callModalName">Cliente</div>
            <div class="call-modal-session" id="callModalSession">Sess√£o ‚Äî</div>
          </div>
        </div>
        <div class="call-modal-actions">
          <button type="button" class="call-btn accept" id="callModalAccept">Aceitar</button>
          <button type="button" class="call-btn decline" id="callModalDecline">Recusar</button>
          <button type="button" class="call-btn mute" id="callModalMute" hidden>Silenciar</button>
          <button type="button" class="call-btn end" id="callModalHangup" hidden>Encerrar</button>
        </div>
      </div>
    </div>
    <div class="image-lightbox" id="imageLightbox" hidden>
      <div class="image-lightbox-backdrop" data-lightbox-close="true"></div>
      <div class="image-lightbox-dialog" role="dialog" aria-modal="true" aria-label="Visualizador de imagem">
        <div class="image-lightbox-actions">
          <button type="button" id="imageLightboxZoomOut" aria-label="Reduzir zoom">‚àí</button>
          <button type="button" id="imageLightboxZoomIn" aria-label="Aumentar zoom">+</button>
          <a id="imageLightboxOpen" target="_blank" rel="noopener noreferrer">Abrir em nova guia</a>
          <a id="imageLightboxDownload" download>Baixar</a>
          <button type="button" id="imageLightboxClose" aria-label="Fechar visualizador">‚úï</button>
        </div>
        <div class="image-lightbox-content" data-lightbox-close="true">
          <img id="imageLightboxImage" alt="Imagem ampliada do chat" />
        </div>
      </div>
    </div>
    <div class="toast" id="toast" role="status" aria-live="polite" hidden></div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/common.js"></script>
    <script src="/central-config.js"></script>
    <script src="/central.js" type="module"></script>
    <script>
      const switcher = document.getElementById('themeSwitch');
      switcher?.addEventListener('click', () => {
        const body = document.body;
        const light = body.getAttribute('data-theme') === 'light';
        body.setAttribute('data-theme', light ? 'dark' : 'light');
        switcher.textContent = light ? 'Tema claro' : 'Tema escuro';
      });

      const autoSwitch = document.getElementById('autoSwitch');
      const autoSwitchLabel = document.getElementById('autoSwitchLabel');
      autoSwitch?.addEventListener('change', () => {
        const on = !!autoSwitch.checked;
        if(autoSwitchLabel){
          autoSwitchLabel.textContent = on ? 'ACEITANDO AUTOMATICAMENTE' : 'ACEITAR CHAMADOS AUTOMATICAMENTE';
          autoSwitchLabel.classList.toggle('on', on);
        }
      });
      if(autoSwitchLabel){
        autoSwitchLabel.classList.toggle('on', !!autoSwitch?.checked);
      }

    </script>
  </body>
</html>
